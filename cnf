
# Set server name, database name, and credentials
$ServerName = "database-1.c1kagg4887d8.ap-southeast-2.rds.amazonaws.com"
$DatabaseName = "database-1"
$Username = 
$Password = ""

# Construct the connection string (without specifying the database initially)
$InitialConnectionString = "Provider=MSOLEDBSQL.1;Data Source=$ServerName;User ID='$Username';Password='$Password'"

# Attempt to create a connection without specifying the database
Try {
    $Connection = New-Object System.Data.OleDb.OleDbConnection($InitialConnectionString)
    $Connection.Open()

    # Check if the database exists
    $DatabaseExists = $Connection.GetSchema("Databases").Rows.Contains($DatabaseName)

    # If the database doesn't exist, create it
    If (!$DatabaseExists) {
        Write-Host "Database $DatabaseName does not exist. Creating it..."
        $CreateDatabaseCommand = "CREATE DATABASE $DatabaseName"
        $Command = New-Object System.Data.OleDb.OleDbCommand($CreateDatabaseCommand, $Connection)
        $Command.ExecuteNonQuery()
        Write-Host "Database $DatabaseName created successfully."
    } Else {
        Write-Host "Database $DatabaseName already exists."
    }
} Catch {
    Write-Host "Connection failed: $_"
} Finally {
    $Connection.Close()
}

# Now try connecting to the database (whether it was created or already existed)
Try {
    $ConnectionString = "Provider=MSOLEDBSQL.1;Data Source=$ServerName;Initial Catalog=$DatabaseName;User ID='$Username';Password='$Password'"
    $Connection = New-Object System.Data.OleDb.OleDbConnection($ConnectionString)
    $Connection.Open()
    Write-Host "Connection to database $DatabaseName successful!"
} Catch {
    Write-Host "Connection to database $DatabaseName failed: $_"
} Finally {
    $Connection.Close()
}
